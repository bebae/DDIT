<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>쇼핑카트 페이지</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../css/shopingCart.css">
</head>

<body>
    <div class="container">
        <h1>쇼핑카트</h1>
        <table>
            <thead>
                <tr>
                    <th>이미지</th>
                    <th>제품명</th>
                    <th>판매가</th>
                    <th>개수</th>
                    <th>합계</th>
                    <th>선택</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <div class="product-image"><img src="../images/cart01.jpg"alt="Product 1"></div>
                    </td>
                    <td class="product-name">컬쳐랜드 1만원 상품권</td>
                    <td class="product-price">10000</td>
                    <td class="product-quantity">
                        <input type="number" min="1" max="10" value="1">
                    </td>
                    <td class="product-total">10000</td>
                    <td class="product-delete">
                        <div class="flex-container">
                            <button onclick="showPrompt()">주문</button>
                            <button onclick="deleteItem(this)">삭제</button>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="product-image"><img src="../images/board01.jpg"alt="Product 2"></div>
                    </td>
                    <td class="product-name">할리갈리 시리즈 모음</td>
                    <td class="product-price">12920</td>
                    <td class="product-quantity">
                        <input type="number" min="1" max="10" value="1">
                    </td>
                    <td class="product-total">12920</td>
                    <td class="product-delete">
                        <div class="flex-container">
                            <button onclick="showPrompt()">주문</button>
                            <button onclick="deleteItem(this)">삭제</button>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="product-image"><img src="../images/com_1.PNG"alt="Product 3"></div>
                    </td>
                    <td class="product-name">다나와표준PC 게임용 230417<br>(16GB, SSD 512GB)</td>
                    <td class="product-price">1531730</td>
                    <td class="product-quantity">
                        <input type="number" min="1" max="10" value="1">
                    </td>
                    <td class="product-total">1531730</td>
                    <td class="product-delete">
                        <div class="flex-container">
                            <button onclick="showPrompt()">주문</button>
                            <button onclick="deleteItem(this)">삭제</button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="total">총합계 : <span id="totalAmount">60000</span></div>
        <button class="purchase-button">구매하기</button>
        <script type="text/javascript">
            function showPrompt() {
                alert("미구현 상태입니다.");
            }
            window.addEventListener('DOMContentLoaded', () => {
                const numbers = document.querySelectorAll('.product-price, .product-total, #totalAmount');
                numbers.forEach(number => {
                    const formattedNumber = Number(number.textContent).toLocaleString('en');
                    number.textContent = `${formattedNumber}원`;
                });
                updateTotal();
            });
            function updatePriceElements() {
                // .product-quantity의 input 요소를 모두 선택합니다.
                const quantities = document.querySelectorAll('.product-quantity input');
                // 각각의 .product-quantity input 요소에 대해 이벤트 리스너를 등록합니다.
                quantities.forEach(quantity => {
                    quantity.addEventListener('change', () => {
                        // 현재 .product-quantity input 요소의 값과 그 부모 요소의 형제 요소인 .product-pricedmf의 텍스트 값을 가져옵니다.
                        const quantityValue = quantity.value;
                        const price = quantity.parentElement.previousElementSibling.textContent;
                        // .product-pricedmf의 텍스트 값을 정규식을 사용하여 숫자만 추출합니다.
                        const priceValue = Number(price.replace(/[^0-9]/g, ''));

                        // .product-total의 값을 갱신합니다.
                        const total = priceValue * quantityValue;
                        const formattedTotal = total.toLocaleString();
                        quantity.parentElement.nextElementSibling.textContent = formattedTotal;
                        // updateTotal 함수를 호출합니다.
                        updateTotal();
                    });
                });
            }

            function deleteItem(btn) {
                var row = btn.parentNode.parentNode.parentNode;
                row.parentNode.removeChild(row);
                updateTotal();
            }

            function updateTotal() {
                var totalAmount = 0;
                var quantityElements = document.getElementsByClassName('product-quantity');
                var priceElements = document.getElementsByClassName('product-price');
                var totalElements = document.getElementsByClassName('product-total');

                for (var i = 0; i < totalElements.length; i++) {
                    var quantity = parseInt(quantityElements[i].querySelector('input').value);
                    var price = parseInt(priceElements[i].innerText.replace(/[^0-9]/g, ''));
                    if (!isNaN(quantity) && !isNaN(price)) {
                    totalElements[i].innerText = (quantity * price).toLocaleString() + '원';
                    totalAmount += quantity * price;
                    }
                }

                document.getElementById('totalAmount').innerText = totalAmount.toLocaleString() + '원';
            }
            updatePriceElements();
        </script>
    </div>
</body>

</html>