<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
    crossorigin="anonymous"></script>

  <style>
    .div {
      margin: 10px auto;
      width: 90%;
      text-align: center;
    }
  </style>
</head>

<body>
  <div class="div m-5">
    <!-- 제목 -->
    <h1>API TEST HTML</h1>
  </div>
  <div class="div">
    <h2> CHAT-GPT</h2>
    <div class="row g-3 align-items-center d-flex justify-content-center">
      <!-- 키워드 입력창 -->
      <!-- <label for="keywords">키워드:</label> -->
      <div class="col-auto ">
        <label for="keywords" class="">질문:</label>
      </div>
      <div class="col-7">
        <input type="text" id="keywords" name="keywords" class="form-control" required />
      </div>
      <!-- 입력 버튼 -->
      <div class="col-auto">
        <button type="button" class="btn btn-primary" onclick="search()">입력</button>
      </div>
      <!-- 결과가 보이게 될 부분 -->
      <div id="result" class="mb-5 text-start"></div>
    </div>

    <div class="row g-2">
      <div class="col-auto">
        <label for="text" class="col-form-label">질문</label>
      </div>
      <div class="input-group col-auto">
        <input type="text" class="form-control" placeholder="Recipient's username" aria-label="Recipient's username"
          aria-describedby="button-addon2">
        <button class="btn btn-outline-secondary" type="button" id="button-addon2">질문하기</button>
      </div>
    </div>
  </div>
  <div class="mt-5">
    <h2>Kakao Library</h2>
    <div class="row justify-content-center">
      <div class="form-floating col-5">
        <input type="email" class="form-control mt-4" id="floatingInput" placeholder="name@example.com">
        <label class="mt-4 mx-2" for="floatingInput">검색 단어</label>
      </div>
      <div class="col-auto mt-4">
        <button type="button" class="btn btn-primary p-3" onclick="searchBook()">검색</button>
      </div>
      <div class="div">
        <div class="mb-3 text-start d-inline-block">
          <h4>검색 결과 출력 부분</h4>
          <div class="row row-cols-1 row-cols-md-2 justify-content-center">
            <div class="col mb-3">
              <div class="card" style="max-width: 720px;">
                <div class="row g-0">
                  <div class="col-md-5">
                    <img src="http://placehold.it/400x600" class="card-img-top" id="bookImg0" alt="...">
                  </div>
                  <div class="col-md-7">
                    <div class="card-body">
                      <h5 id="bookTitle0" class="card-title" style="word-break: keep-all;">title</h5>
                      <h6 class="mb-3">출판사: <span id="bookPublisher0">bookPublisher</span></h6>
                      <p class="card-text" id="bookContents0">Some quick example text to build on the card title and
                        make up the bulk of the card's content.</p>
                      <a href="#" class="btn btn-primary">상세보기</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col mb-3">
              <div class="card" style="max-width: 720px;">
                <div class="row g-0">
                  <div class="col-md-5">
                    <img src="http://placehold.it/400x600" class="card-img-top" id="bookImg1" alt="...">
                  </div>
                  <div class="col-md-7">
                    <div class="card-body">
                      <h5 id="bookTitle1" class="card-title" style="word-break: keep-all;">title</h5>
                      <h6 class="mb-3">출판사: <span id="bookPublisher1">bookPublisher</span></h6>
                      <p class="card-text" id="bookContents1">Some quick example text to build on the card title and
                        make up the bulk of the card's content.</p>
                      <a href="#" class="btn btn-primary">상세보기</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col mb-3">
              <div class="card" style="max-width: 720px;">
                <div class="row g-0">
                  <div class="col-md-5">
                    <img src="http://placehold.it/400x600" class="card-img-top" id="bookImg2" alt="...">
                  </div>
                  <div class="col-md-7">
                    <div class="card-body">
                      <h5 id="bookTitle2" class="card-title" style="word-break: keep-all;">title</h5>
                      <h6 class="mb-3">출판사: <span id="bookPublisher2">bookPublisher</span></h6>
                      <p class="card-text" id="bookContents2">Some quick example text to build on the card title and
                        make up the bulk of the card's content.</p>
                      <a href="#" class="btn btn-primary">상세보기</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col mb-3">
              <div class="card" style="max-width: 720px;">
                <div class="row g-0">
                  <div class="col-md-5">
                    <img src="http://placehold.it/400x600" class="card-img-top" id="bookImg3" alt="...">
                  </div>
                  <div class="col-md-7">
                    <div class="card-body">
                      <h5 id="bookTitle3" class="card-title" style="word-break: keep-all;">title</h5>
                      <h6 class="mb-3">출판사: <span id="bookPublisher3">bookPublisher</span></h6>
                      <p class="card-text" id="bookContents3">Some quick example text to build on the card title and
                        make up the bulk of the card's content.</p>
                      <a href="#" class="btn btn-primary">상세보기</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="div">
    <h1>Library</h1>
    <div class="row g-3 align-items-center d-flex justify-content-center">
      <div class="col-auto ">
        <label for="keywords2" class="">검색:</label>
      </div>
      <div class="col-7">
        <input type="text" id="keywords2" name="keywords2" class="form-control" required />
      </div>
      <div class="col-auto">
        <button type="button" class="btn btn-primary" onclick="searchTwo()">입력</button>
      </div>
    </div>
    <div>
      <div class="card">
        <div class="row g-0">
          <div class="col-md-5">
            <img id="searchBookImg" src="http://placehold.it/400x300" alt="샘플">
          </div>
          <div class="col-md-7">
            <div class="card-bady mt-3">
              <h5 id="searchBookTitle">타이틀 부분</h5>
              <p id="searchBookText" class="card-text">설명부분</p>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script>
    function searchTwo() {
      const searchBook = document.querySelector('#keywords2').value || '';
      $.ajax({
          type:"GET",
          url: "http://api.kcisa.kr/openapi/service/rest/meta2020/getNLSFdb",
          success: function(data) {
            console.log(data);

          },
          error: function(error) {
          // API 요청 오류 처리
          console.log(error);
          }
      });
    }

    function searchBook() {
      const searchBook = document.querySelector('#floatingInput').value || '';
      $.ajax({
        method: "GET",
        url: "https://dapi.kakao.com/v3/search/book?target=title",
        data: {
          query: searchBook
        },
        headers: {
          Authorization: "KakaoAK 0f7acd5ca96b1d76578d02adc4161263"
        },
      })
        .done(function (msg) {
          for (let i = 0; i < 4; i++) {
            if (msg.documents[i]) {
              const bookTitle = msg.documents[i].title;
              const bookPublisher = msg.documents[i].publisher;
              const bookImg = msg.documents[i].thumbnail;
              const bookContents = msg.documents[i].contents;

              $(`#bookTitle${i}`).html(`<strong>${bookTitle}</strong>`);
              $(`#bookPublisher${i}`).html(bookPublisher);
              $(`#bookImg${i}`).attr("src", bookImg);
              $(`#bookContents${i}`).html(bookContents);
            }
          }
        });
    }

    function search() {
      const api_key = "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";
      const keywords = document.getElementById('keywords').value
      const messages = [
        { role: 'system', content: 'You are a helpful assistant.' },
        // { role: 'user', content: keywords + '에 대하여 다루어 볼 만한 주제를 10가지 추천해줘.' },
        { role: 'user', content: keywords },

      ]
      const config = {
        headers: {
          Authorization: `Bearer ${api_key}`,
          'Content-Type': 'application/json',
        },
      }
      const data = {
        model: 'gpt-3.5-turbo',
        temperature: 0.5,
        n: 1,
        messages: messages,
      }
      axios
        .post('https://api.openai.com/v1/chat/completions', data, config)
        .then(function (response) {
          let resultDiv = document.getElementById('result')
          resultDiv.innerHTML = ''
          response.data.choices.forEach(function (choice, index) {
            resultDiv.innerHTML += `<div>${choice.message.content
              .split('\n')
              .join('<br/>')}</div>`
          })
        })
        .catch(function (error) {
          console.error(error)
        })

    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
    crossorigin="anonymous"></script>
</body>

</html>